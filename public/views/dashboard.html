<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamBo | Twoje marzenia</title>
    <link rel="stylesheet" href="/public/styles/main.css">
    <link rel="stylesheet" href="/public/styles/dashboard.css">
</head>
<body class="dashboard-body">

<main class="dashboard-container">
    
    <header class="dream-header">
        <div class="dream-logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#000000" viewBox="0 0 256 256">
                <path d="M192,116a12,12,0,1,1-12-12A12,12,0,0,1,192,116ZM152,64H112a8,8,0,0,0,0,16h40a8,8,0,0,0,0-16Zm96,48v32a24,24,0,0,1-24,24h-2.36l-16.21,45.38A16,16,0,0,1,190.36,224H177.64a16,16,0,0,1-15.07-10.62L160.65,208h-57.3l-1.92,5.38A16,16,0,0,1,86.36,224H73.64a16,16,0,0,1-15.07-10.62L46,178.22a87.69,87.69,0,0,1-21.44-48.38A16,16,0,0,0,16,144a8,8,0,0,1-16,0,32,32,0,0,1,24.28-31A88.12,88.12,0,0,1,112,32H216a8,8,0,0,1,0,16H194.61a87.93,87.93,0,0,1,30.17,37c.43,1,.85,2,1.25,3A24,24,0,0,1,248,112Zm-16,0a8,8,0,0,0-8-8h-3.66a8,8,0,0,1-7.64-5.6A71.9,71.9,0,0,0,144,48H112A72,72,0,0,0,58.91,168.64a8,8,0,0,1,1.64,2.71L73.64,208H86.36l3.82-10.69A8,8,0,0,1,97.71,192h68.58a8,8,0,0,1,7.53,5.31L177.64,208h12.72l18.11-50.69A8,8,0,0,1,216,152h8a8,8,0,0,0,8-8Z"></path>
            </svg> 
            <span>DreamBo</span>
        </div>
        <div class="overall-progress-section">
            <div class="progress-info-row">
                <span class="label">Ca≈Çkowity postƒôp</span>
                <span class="value" id="total-progress-text"><?= $totalProgress ?>%</span>
            </div>
            <div class="main-bar-outer">
                <div class="main-bar-fill" id="total-progress-bar" style="width: <?= $totalProgress ?>%;"></div>
            </div>
            </div>
    </header>

    <nav class="action-grid">
        <a href="/addGoal" class="action-btn">
            <div class="icon-wrapper pink-bg">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#000000" viewBox="0 0 256 256"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm48-88a8,8,0,0,1-8,8H136v32a8,8,0,0,1-16,0V136H88a8,8,0,0,1,0-16h32V88a8,8,0,0,1,16,0v32h32A8,8,0,0,1,176,128Z"></path></svg>
            </div>
            <span>Dodaj cel</span>
        </a>
        <a href="/gallery" class="action-btn">
            <div class="icon-wrapper pink-bg">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#000000" viewBox="0 0 256 256"><path d="M216,40H72A16,16,0,0,0,56,56V72H40A16,16,0,0,0,24,88V200a16,16,0,0,0,16,16H184a16,16,0,0,0,16-16V184h16a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM72,56H216v62.75l-10.07-10.06a16,16,0,0,0-22.63,0l-20,20-44-44a16,16,0,0,0-22.62,0L72,109.37ZM184,200H40V88H56v80a16,16,0,0,0,16,16H184Zm32-32H72V132l36-36,49.66,49.66a8,8,0,0,0,11.31,0L194.63,120,216,141.38V168ZM160,84a12,12,0,1,1,12,12A12,12,0,0,1,160,84Z"></path></svg>
            </div>
            <span>Galeria</span>
        </a>
    </nav>

    <section class="goals-list">
        <h2 class="section-title">Twoje cele</h2>
    
        <?php if (empty($goals)) : ?>
            <p class="empty-msg">Nie masz jeszcze ≈ºadnych marze≈Ñ. Dodaj sw√≥j pierwszy cel!</p>
        <?php else: ?>
        <?php 
            $iconMap = [
                'plane'  => '‚úàÔ∏è',
                'laptop' => 'üíª',
                'house'   => 'üè†',
                'car'    => 'üöó',
                'book'   => 'üìö',
                'target' => 'üéØ'
            ];
        ?>
            <?php foreach ($goals as $goal): ?>
            <div class="goal-item-card">
                <div class="goal-left-content">
                    <div class="goal-icon">
                        <span>
                            <?php 
                                // ZMIANA: u≈ºywamy -> zamiast ['']
                                $dbIcon = $goal->categoryIcon ?? 'target';
                                echo $iconMap[$dbIcon] ?? 'üéØ'; 
                            ?>
                        </span> 
                    </div>
                    <div class="goal-data">
                        <div class="goal-header">
                            <span class="title"><?= htmlspecialchars($goal->title) ?></span>
                            
                            <span class="perc" id="goal-perc-<?= $goal->id ?>">
                                <?= (int)($goal->progressPercentage ?? 0) ?>%
                            </span>
                        </div>
                        <div class="small-bar-outer">
                            <div class="small-bar-fill" 
                                id="goal-bar-<?= $goal->id ?>" 
                                style="width: <?= (int)($goal->progressPercentage ?? 0) ?>%">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="goal-actions">
                    <a href="/editGoal?id=<?= $goal->id ?>" class="edit-btn" title="Edytuj cel">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#6B7280" viewBox="0 0 256 256">
                            <path d="M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152.05a16,16,0,0,0-4.69,11.31v44.69a16,16,0,0,0,16,16H92.69a16,16,0,0,0,11.31-4.69L227.31,96a16,16,0,0,0,0-22.63ZM92.69,208H48V163.31l88-88L180.69,120ZM192,108.68,147.31,64l24-24L216,84.68Z"></path>
                        </svg>
                    </a>
                
                    <form action="/deleteGoal" method="POST" onsubmit="return confirm('Czy na pewno chcesz usunƒÖƒá ten cel? Tej operacji nie mo≈ºna cofnƒÖƒá.');" style="margin:0;">
                        <input type="hidden" name="id" value="<?= $goal->id ?>">
                        <button type="submit" class="delete-btn" title="Usu≈Ñ cel">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#EF4444" viewBox="0 0 256 256">
                                <path d="M216,48H176V40a24,24,0,0,0-24-24H104A24,24,0,0,0,80,40v8H40a8,8,0,0,0,0,16h8V208a16,16,0,0,0,16,16H192a16,16,0,0,0,16-16V64h8a8,8,0,0,0,0-16ZM96,40a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8v8H96Zm96,168H64V64H192ZM112,104v64a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Zm48,0v64a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Z"></path>
                            </svg>
                        </button>
                    </form>
                
                    <button class="add-funds-btn" data-id="<?= $goal->id ?>">+</button>
                </div>
            </div>
        <?php endforeach; ?>
        <?php endif; ?>
    </section>

</main>

<nav class="mobile-nav">
    <a href="/dashboard" class="nav-item">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#000000" viewBox="0 0 256 256"><path d="M219.31,108.68l-80-80a16,16,0,0,0-22.62,0l-80,80A15.87,15.87,0,0,0,32,120v96a8,8,0,0,0,8,8h64a8,8,0,0,0,8-8V160h32v56a8,8,0,0,0,8,8h64a8,8,0,0,0,8-8V120A15.87,15.87,0,0,0,219.31,108.68ZM208,208H160V152a8,8,0,0,0-8-8H104a8,8,0,0,0-8,8v56H48V120l80-80,80,80Z"></path></svg>
    </a>
    <a href="/profile" class="nav-item">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#000000" viewBox="0 0 256 256"><path d="M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z"></path></svg>
    </a>
    <a href="/logout" class="nav-item logout-link-style">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#EF4444" viewBox="0 0 256 256">
            <path d="M112,216a8,8,0,0,1-8,8H48a16,16,0,0,1-16-16V48A16,16,0,0,1,48,32h56a8,8,0,0,1,0,16H48V208h56A8,8,0,0,1,112,216Zm109.66-93.66-40-40a8,8,0,0,0-11.32,11.32L196.69,120H104a8,8,0,0,0,0,16h92.69l-26.35,26.34a8,8,0,0,0,11.32,11.32l40-40A8,8,0,0,0,221.66,122.34Z"></path>
        </svg>
    </a>
</nav>

<div id="funds-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Szybka wp≈Çata</h3>
            <span class="close-modal">&times;</span>
        </div>
        
        <form action="/addFunds" method="POST">
            <input type="hidden" name="goal_id" id="modal-goal-id">
            
            <div class="modal-body">
                <label for="amount-input">Kwota wp≈Çaty</label>
                <div class="input-with-suffix">
                    <input type="number" id="amount-input" name="amount" placeholder="np. 50" step="0.01" required>
                    <span class="suffix">PLN</span>
                </div>
            </div>

            <button type="submit" class="modal-submit-btn">Zatwierd≈∫ wp≈Çatƒô</button>
        </form>
    </div>
</div>

<script src="/public/scripts/dashboard.js"></script>

</body>
</html>